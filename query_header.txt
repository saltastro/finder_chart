SELECT STRAIGHT_JOIN Block.Block_Id, Block_Name, Proposal_Code, Target_Name, Priority, OldPiPriority, ActOnAlert, NVisits, NDone, NAttempted, LastObserved, WaitDays, ObsTime, MaxSeeing, Moon, Transparency, Surname, Title, Target.Target_Id, TargetCoordinates.RaH, TargetCoordinates.RaM, TargetCoordinates.RaS, TargetCoordinates.DecSign, TargetCoordinates.DecD, TargetCoordinates.DecM, TargetCoordinates.DecS, TargetCoordinates.Equinox, MaxMag, Observation.Observation_Order, TelescopeConfig.PositionAngle, TelescopeConfig.UseParallacticAngle, MinUsefulScienceTime, EstripS, EstripE, WstripS, WstripE, EazS, EazE, WazS, WazE, ObsWindowStart, ObsWindowEnd, PellicleSetup, Salticam.Salticam_Id, SalticamDetectorMode.DetectorMode, Rss.Rss_Id, RssMode.Mode, RssDetectorMode.DetectorMode  FROM  Proposal 
      JOIN ProposalCode using (ProposalCode_Id)
      JOIN ProposalContact USING (Proposal_Id) 
      JOIN Investigator ON (Leader_Id=Investigator_Id)
      JOIN Block USING (Proposal_Id)
      JOIN SubBlock ON (Block.Block_Id=SubBlock.Block_Id)
      JOIN SubSubBlock ON (SubBlock.Block_Id=SubSubBlock.Block_Id AND SubBlock.SubBlock_Order=SubSubBlock.SubBlock_Order)
      JOIN Pointing ON (Block.Block_Id=Pointing.Block_Id AND SubBlock.SubBlock_Order=Pointing.SubBlock_Order AND SubSubBlock.SubSubBlock_Order=Pointing.SubSubBlock_Order)
      JOIN Observation USING (Pointing_Id)
      LEFT JOIN TimeRestricted ON (Observation.Pointing_Id=TimeRestricted.Pointing_Id AND Observation.Observation_Order=TimeRestricted.Observation_Order)
      JOIN Moon USING (Moon_Id)
      JOIN Transparency USING (Transparency_Id)
      JOIN TelescopeConfig ON (Pointing.Pointing_Id=TelescopeConfig.Pointing_Id AND Observation.Observation_Order=TelescopeConfig.Observation_Order)
      JOIN TelescopeConfigObsConfig ON (Pointing.Pointing_Id=TelescopeConfigObsConfig.Pointing_Id AND Observation.Observation_Order=TelescopeConfigObsConfig.Observation_Order AND TelescopeConfig.TelescopeConfig_Order=TelescopeConfigObsConfig.TelescopeConfig_Order)
      JOIN ObsConfig ON (TelescopeConfigObsConfig.PlannedObsConfig_Id=ObsConfig.ObsConfig_Id)
      JOIN PayloadConfig USING (PayloadConfig_Id)
      JOIN Target ON (Observation.Target_Id=Target.Target_Id)
      JOIN TargetCoordinates USING (TargetCoordinates_Id)
      JOIN TargetMagnitudes ON (TargetMagnitudes.TargetMagnitudes_Id=Target.TargetMagnitudes_Id)
      LEFT JOIN GuideStar ON (TelescopeConfig.GuideStar_Id=GuideStar.GuideStar_Id)


      LEFT JOIN (SalticamPatternDetail
           JOIN Salticam ON (SalticamPatternDetail.Salticam_Id=Salticam.Salticam_Id)
           JOIN SalticamDetector ON (Salticam.SalticamDetector_Id=SalticamDetector.SalticamDetector_Id)
           JOIN SalticamDetectorMode ON (SalticamDetectorMode.SalticamDetectorMode_Id=SalticamDetector.SalticamDetectorMode_Id)
           ) ON (ObsConfig.SalticamPattern_Id=SalticamPatternDetail.SalticamPattern_Id)

      LEFT JOIN (RssPatternDetail
           JOIN Rss ON (RssPatternDetail.Rss_Id=Rss.Rss_Id)
           JOIN RssConfig USING (RssConfig_Id)
           JOIN RssMode USING (RssMode_Id)
           JOIN RssDetector ON (Rss.RssDetector_Id=RssDetector.RssDetector_Id)
           JOIN RssDetectorMode USING (RssDetectorMode_Id)
           )
           ON (ObsConfig.RssPattern_Id=RssPatternDetail.RssPattern_Id) WHERE 
PayloadConfigType_Id=3 and
Current=1 and 
PhaseFinal=1 and 
ProposalStatus_Id=1 and 

  (Salticam.Salticam_Id IS NULL OR 
  			Salticam.Salticam_Id IN 
  (SELECT STRAIGHT_JOIN Salticam_Id from Salticam JOIN 
  	  SalticamProcedure USING (SalticamProcedure_Id) 
	  JOIN SalticamFilterPatternDetail USING
  			(SalticamFilterPattern_Id) 
	  WHERE SalticamFilter_Id  IN (Select SalticamFilter_Id from
  			SalticamCurrentFilters) and
  			SalticamFilterPattern_Id not in 
			(Select SalticamFilterPattern_Id from
  			SalticamFilterPatternDetail where
  			SalticamFilter_Id NOT IN (select
  			SalticamFilter_Id from
  			SalticamCurrentFilters)))) and ( Rss_Id IS
  			NULL OR  Rss.Rss_Id IN (select Rss_Id from Rss
  			Join RssConfig using (RssConfig_Id) join
  			RssMask using (RssMask_Id) where
  			RssMaskType_Id <> 1 OR RssMask_Id IN (select
  			RssMask_Id from RssCurrentMasks))   ) and
  			NDone < NVisits and 
			(OnHold=0 or OnHold IS NULL) and 
			(ADDDATE(LastObserved, INTERVAL WaitDays day)
